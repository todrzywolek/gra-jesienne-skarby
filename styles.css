:root{
  --bg:#f8fafc;
  --ink:#0f172a;
  --muted:#475569;
  --accent:#d97706; /* jesienny pomarańcz */
  --good:#16a34a;
  --card:#ffffff;
  --shadow:0 6px 24px rgba(15,23,42,.08);
  --chest:#b5813d;       /* kolor skrzyni */
  --chest-dark:#8c632c;  /* pokrywa */
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans', Ubuntu, Cantarell, 'Helvetica Neue', Arial, "Apple Color Emoji","Segoe UI Emoji";
  background:var(--bg);
  color:var(--ink);
  overflow-x: hidden;
}

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:1rem;
  padding:1.25rem clamp(1rem, 3vw, 2rem);
  background:var(--card);
  box-shadow:var(--shadow);
  position:sticky; top:0; z-index:20;
}
.title{font-weight:700; font-size:clamp(20px,2.8vw,26px)}
.hud{display:flex; align-items:center; gap:.75rem}
.score{font-weight:600}

button{
  appearance:none; border:0; border-radius:14px; padding:.75rem 1.25rem; font-weight:600;
  background:var(--accent); color:#fff; box-shadow:var(--shadow);
  font-size: 1rem;
}
button.ghost{background:transparent; color:var(--muted); box-shadow:none; border:2px solid #e2e8f0}
button.primary{background:var(--good);}

.game-wrap{
  display:grid;
  grid-template-columns: 1fr minmax(240px, 320px);
  gap:clamp(.75rem,2vw,1.5rem);
  padding:clamp(1rem, 2.5vw, 2rem);
  align-items:stretch;
  max-width: 1400px;
  margin: 0 auto;
}

.playfield{
  position:relative;
  min-height:min(75vh, 600px);
  background:linear-gradient(0deg,#fff, #fff), conic-gradient(from 0deg,#fef3c7,#ffedd5,#f1f5f9,#e2e8f0,#fef3c7);
  border-radius:18px;
  box-shadow:var(--shadow);
  overflow:hidden;
  touch-action:none; /* aby pointermove działał płynnie na dotyku */
}

.bins{
  display:grid;
  grid-template-columns: 1fr;
  gap:clamp(.6rem,1.6vw,1rem);
  align-content:start;
}

.bin{
  display:flex; align-items:center; gap:.75rem;
  background:var(--card);
  border-radius:16px;
  box-shadow:var(--shadow);
  padding:1rem;
  min-height:90px;
  position:relative;
}

/* Rysunek skrzyni */
.bin .chest{
  width:82px; height:64px; position:relative; flex:0 0 auto;
  border-radius:10px;
  background:var(--chest);
  box-shadow:inset 0 -6px 0 rgba(0,0,0,.08);
}
.bin .chest::before{
  content:""; position:absolute; left:0; right:0; top:-12px; height:20px;
  background:var(--chest-dark);
  border-radius:10px 10px 4px 4px;
  box-shadow:0 3px 0 rgba(0,0,0,.06);
}
.bin .label{
  position:absolute; left:50%; top:38%; transform:translate(-50%,-50%);
  width:42px; height:42px; display:grid; place-items:center;
  background:#fff; border-radius:12px; box-shadow:0 2px 0 rgba(0,0,0,.08);
  overflow:hidden;
}
.bin .name{font-weight:700; color:#0f172a; font-size:1rem}

/* Spadający skarb */
.treasure{
  position:absolute; width:80px; height:80px;
  display:grid; place-items:center;
  border-radius:16px;
  background:#fff;
  box-shadow:var(--shadow);
  user-select:none; touch-action:none;
}
.treasure img, .treasure svg{
  width:72px; height:72px; pointer-events:none; display:block;
}

/* Podczas przeciągania lekka skala */
.treasure.dragging{transform:scale(1.06)}
.treasure.correct{outline:4px solid rgba(22,163,74,.35)}
.treasure.wrong{outline:4px solid rgba(220,38,38,.35)}

/* Modal */
.modal{
  position:fixed; inset:0; display:grid; place-items:center; background:rgba(2,6,23,.55);
}
.modal.hidden{display:none}
.modal-card{
  width:min(92vw,560px);
  background:var(--card); border-radius:18px; box-shadow:var(--shadow);
  padding:1.25rem;
  text-align:center;
}
.trophy{display:grid; place-items:center; gap:.5rem; margin:1rem 0}
.trophy-icon{width:96px; height:96px; display:grid; place-items:center; background:#fff; border-radius:24px; box-shadow:var(--shadow)}
.trophy-icon img{width:84px; height:84px}

/* Tablet landscape optimization (1280x800 and similar) */
@media (min-width: 1024px) and (max-width: 1400px) and (min-height: 700px) {
  .game-wrap{
    grid-template-columns: 1fr minmax(280px, 350px);
    gap: 1.5rem;
    padding: 1.5rem;
  }
  .playfield{
    min-height: min(70vh, 550px);
  }
  .bins{
    gap: 1rem;
  }
  .bin{
    min-height: 95px;
    padding: 1.25rem;
  }
  .bin .chest{
    width: 88px; height: 68px;
  }
  .bin .label{
    width: 46px; height: 46px;
  }
  .treasure{
    width: 84px; height: 84px;
  }
  .treasure img, .treasure svg{
    width: 76px; height: 76px;
  }
}

/* iPhone 12 Pro specific optimization (390x844) */
@media (max-width: 390px) and (max-height: 900px) {
  .topbar{
    padding: 0.5rem 0.75rem;
    min-height: 60px;
  }
  .title{
    font-size: 16px;
  }
  .score{
    font-size: 13px;
  }
  button{
    padding: 0.4rem 0.6rem;
    font-size: 13px;
  }
  
  .game-wrap{
    padding: 0.5rem;
    height: calc(100vh - 60px);
    gap: 0.5rem;
  }
  
  .playfield{
    height: 55%;
    max-height: 350px;
  }
  
  .bins{
    height: 45%;
    max-height: 280px;
    gap: 0.4rem;
  }
  
  .bin{
    min-height: 65px;
    padding: 0.4rem;
  }
  
  .bin .chest{
    width: 45px;
    height: 35px;
  }
  
  .bin .label{
    width: 25px;
    height: 25px;
  }
  
  .bin .name{
    font-size: 11px;
  }
  
  .treasure{
    width: 55px;
    height: 55px;
  }
  
  .treasure img, .treasure svg{
    width: 48px;
    height: 48px;
  }
  
  .modal-card{
    width: 95vw;
    padding: 0.75rem;
    margin: 0.5rem;
    max-height: 90vh;
    overflow-y: auto;
  }
  
  .trophy-icon{
    width: 70px;
    height: 70px;
  }
  
  .trophy-icon img{
    width: 60px;
    height: 60px;
  }
}

/* Mobile portrait optimization (general mobile) */
@media (max-width: 480px) {
  .topbar{
    padding: 0.75rem 1rem;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .title{
    font-size: 18px;
    flex: 1;
    min-width: 0;
  }
  .hud{
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  .score{
    font-size: 14px;
  }
  button{
    padding: 0.5rem 0.75rem;
    font-size: 14px;
  }
  
  .game-wrap{
    grid-template-columns: 1fr;
    gap: 0.75rem;
    padding: 0.75rem;
    height: calc(100vh - 80px);
  }
  
  .playfield{
    min-height: 0;
    height: 60%;
    max-height: 400px;
  }
  
  .bins{
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    height: 40%;
    max-height: 300px;
    overflow-y: auto;
  }
  
  .bin{
    min-height: 70px;
    padding: 0.5rem;
    flex-direction: column;
    text-align: center;
    gap: 0.25rem;
  }
  
  .bin .chest{
    width: 50px;
    height: 40px;
  }
  
  .bin .label{
    width: 28px;
    height: 28px;
    top: 30%;
  }
  
  .bin .name{
    font-size: 12px;
    line-height: 1.2;
  }
  
  .treasure{
    width: 60px;
    height: 60px;
  }
  
  .treasure img, .treasure svg{
    width: 52px;
    height: 52px;
  }
  
  .modal-card{
    width: 95vw;
    padding: 1rem;
    margin: 0.5rem;
    max-height: 90vh;
    overflow-y: auto;
  }
  
  .trophy-icon{
    width: 80px;
    height: 80px;
  }
  
  .trophy-icon img{
    width: 70px;
    height: 70px;
  }
}

@media (min-width: 481px) and (max-width: 900px){
  .game-wrap{grid-template-columns: 1fr; }
  .bins{grid-template-columns: repeat(2, minmax(0,1fr));}
}

/* Skarb w trybie globalnym (podczas przeciągania) może wyjechać poza pole gry */
.treasure.global{
  position: fixed;        /* klucz: działa w całym widoku, nie tylko w playfield */
  left: 0; top: 0;
  transform: none !important; /* nadpisujemy translate używany normalnie */
  z-index: 50;            /* nad skrzyniami */
}